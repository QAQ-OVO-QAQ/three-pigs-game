<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç³–æœå±‹ï¼šä½å…ƒè…æ•—è¿·å®®</title>
    <style>
        body {
            font-family: "Courier New", monospace; /* ä½¿ç”¨ç­‰å¯¬å­—é«”æ›´æœ‰æ•¸ä½æ„Ÿ */
            background-color: #1a1a1a;
            color: #ddd;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            user-select: none;
        }

        h1 { color: #f1c40f; margin-bottom: 5px; }
        p.subtitle { color: #7f8c8d; font-size: 0.9rem; margin-bottom: 20px; }

        /* éŠæˆ²ç‹€æ…‹åˆ— */
        .status-bar {
            display: flex;
            gap: 20px;
            background: #333;
            padding: 10px 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            border: 1px solid #555;
        }

        .stat-item { font-size: 1.1rem; font-weight: bold; }
        .stone-count { color: #bdc3c7; }
        .bread-count { color: #e67e22; }

        /* è¿·å®®ç¶²æ ¼ */
        .grid-container {
            display: grid;
            grid-template-columns: repeat(5, 60px);
            grid-template-rows: repeat(5, 60px);
            gap: 5px;
            background: #000;
            padding: 10px;
            border-radius: 5px;
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
            position: relative;
        }

        .cell {
            width: 60px;
            height: 60px;
            background-color: #2c3e50;
            border-radius: 4px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 2rem;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
        }

        .cell.fog { background-color: #111; color: transparent; cursor: default; }
        .cell.path-bread { font-size: 1.5rem; } 
        .cell.path-stone { font-size: 1.5rem; border: 2px solid #fff; }
        .cell.player { background-color: #3498db; box-shadow: 0 0 10px #3498db; z-index: 10; }
        .cell.house { background-color: #e74c3c; }
        .cell.start { background-color: #27ae60; }

        /* æ§åˆ¶å€ */
        .controls { margin-top: 20px; text-align: center; }
        .btn-action {
            padding: 10px 20px;
            font-size: 1rem;
            margin: 5px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
        }
        .btn-stone { background: #95a5a6; color: #000; }
        .btn-bread { background: #e67e22; color: white; }
        .btn-reset { background: #c0392b; color: white; margin-top: 20px; display: none;}

        /* è¨Šæ¯å€ */
        .log-box {
            margin-top: 20px;
            height: 100px;
            width: 300px;
            background: #000;
            color: #2ecc71;
            padding: 10px;
            font-size: 0.85rem;
            overflow-y: auto;
            border: 1px solid #333;
            font-family: monospace;
        }
        
        .rotten { animation: rot 0.5s; color: #555 !important; }
        @keyframes rot { 0% { transform: scale(1); } 50% { transform: scale(0.5); } 100% { transform: scale(0); } }

        /* åœ–è³‡èªªæ˜ */
        .metadata-overlay {
            display: none;
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9);
            justify-content: center; align-items: center; flex-direction: column;
            padding: 30px; box-sizing: border-box; text-align: center;
        }
        .meta-box { background: #222; padding: 20px; border-left: 5px solid #f1c40f; max-width: 500px; }
    </style>
</head>
<body>

    <h1>ğŸŒ² ä½å…ƒè…æ•—è¿·å®®</h1>
    <p class="subtitle">ä»»å‹™ï¼šå‰å¾€ç´…è‰²ç³–æœå±‹ä¸¦æ´»è‘—å›ä¾†</p>

    <div class="status-bar">
        <div class="stat-item stone-count">ğŸª¨ çŸ³é ­: <span id="stone-val">3</span></div>
        <div class="stat-item bread-count">ğŸ éºµåŒ…: <span id="bread-val">10</span></div>
    </div>

    <div class="grid-container" id="grid">
        </div>

    <div class="controls">
        <p style="font-size: 0.9rem; color: #aaa;">é»æ“Šç›¸é„°æ ¼å­ç§»å‹•ï¼Œç³»çµ±æœƒè‡ªå‹•æ”¾ç½®æ¨™è¨˜</p>
        <div id="toggle-container">
            ç›®å‰ä½¿ç”¨ï¼š<strong id="current-tool" style="color: #e67e22;">ğŸ éºµåŒ…å±‘</strong><br>
            <button class="btn-action btn-stone" onclick="setTool('stone')">åˆ‡æ›ç”¨çŸ³é ­ (æ°¸ä¹…)</button>
            <button class="btn-action btn-bread" onclick="setTool('bread')">åˆ‡æ›ç”¨éºµåŒ… (æ˜“é€)</button>
        </div>
        <button class="btn-action btn-reset" onclick="location.reload()" id="btn-restart">å†è©¦ä¸€æ¬¡</button>
    </div>

    <div class="log-box" id="game-log">
        > ç³»çµ±å•Ÿå‹•...<br>
        > æ•¸ä½ä¿å­˜å¯¦é©—é–‹å§‹ã€‚<br>
        > è­¦å‘Šï¼šæ£®æ—ä¸­çš„ç”Ÿç‰©æ­£åœ¨ç ´å£è³‡æ–™é€£çµ...
    </div>

    <div id="end-screen" class="metadata-overlay">
        <div class="meta-box">
            <h2 id="end-title"></h2>
            <p id="end-desc"></p>
            <hr style="border-color: #444; margin: 15px 0;">
            <p style="font-size: 0.9rem; color: #aaa; text-align: left;">
                <strong>ã€åœ–æ›¸è³‡è¨Šå­¸è§€å¿µï¼šBit Rotã€‘</strong><br>
                ä½å…ƒè…æ•—ï¼ˆBit Rotï¼‰æ˜¯æŒ‡æ•¸ä½è³‡æ–™å„²å­˜åª’é«”éš¨è‘—æ™‚é–“æ¨ç§»ï¼Œå› ç‰©ç†è¡°è®Šæˆ–æ ¼å¼éæ™‚è€Œå°è‡´çš„è³‡æ–™æå£ã€‚å°±åƒéºµåŒ…å±‘è¢«é³¥åƒæ‰ä¸€æ¨£ï¼Œæ²’æœ‰å¦¥å–„å‚™ä»½ï¼ˆMigration/Emulationï¼‰çš„æ•¸ä½æª”æ¡ˆï¼Œæœ€çµ‚å°‡ç„¡æ³•è®€å–ã€‚
            </p>
            <button class="btn-action btn-bread" onclick="location.reload()">é‡æ–°å¯¦é©—</button>
        </div>
    </div>

<script>
    // --- éŠæˆ²è¨­å®š ---
    const gridSize = 5;
    let playerPos = { x: 0, y: 0 };
    let goalPos = { x: 4, y: 4 }; // ç³–æœå±‹ä½ç½®
    let hasReachedGoal = false;
    let stones = 3;
    let breads = 10;
    let currentTool = 'bread'; // 'bread' or 'stone'
    let gridData = []; // å„²å­˜æ¯ä¸€æ ¼çš„ç‹€æ…‹
    let rotInterval;

    const logBox = document.getElementById('game-log');
    
    // åˆå§‹åŒ–éŠæˆ²
    function initGame() {
        const gridEl = document.getElementById('grid');
        gridEl.innerHTML = '';
        gridData = [];

        for (let y = 0; y < gridSize; y++) {
            let row = [];
            for (let x = 0; x < gridSize; x++) {
                let cell = document.createElement('div');
                cell.className = 'cell fog';
                cell.dataset.x = x;
                cell.dataset.y = y;
                cell.onclick = () => movePlayer(x, y);
                
                gridEl.appendChild(cell);
                
                // è³‡æ–™çµæ§‹
                row.push({
                    el: cell,
                    visited: false,
                    content: null // 'bread', 'stone', 'start', 'goal'
                });
            }
            gridData.push(row);
        }

        // è¨­å®šèµ·é»èˆ‡çµ‚é»
        gridData[0][0].content = 'start';
        gridData[0][0].visited = true;
        gridData[4][4].content = 'goal';

        updateView();
        
        // å•Ÿå‹•ä½å…ƒè…æ•—æ©Ÿåˆ¶ (æ¯ 2.5 ç§’éš¨æ©Ÿåƒæ‰ä¸€å€‹éºµåŒ…)
        rotInterval = setInterval(bitRot, 2500);
    }

    // è™•ç†ç§»å‹•
    function movePlayer(x, y) {
        // æª¢æŸ¥æ˜¯å¦ç›¸é„°
        const dx = Math.abs(x - playerPos.x);
        const dy = Math.abs(y - playerPos.y);
        if (dx + dy !== 1) return; // åªèƒ½èµ°ä¸€æ­¥

        // æª¢æŸ¥è³‡æº
        if (currentTool === 'stone' && stones <= 0 && !gridData[y][x].visited) {
            log("âŒ çŸ³é ­ç”¨å®Œäº†ï¼åªèƒ½ç”¨éºµåŒ…ã€‚");
            return;
        }
        if (currentTool === 'bread' && breads <= 0 && !gridData[y][x].visited) {
            log("âŒ éºµåŒ…ç”¨å®Œäº†ï¼è³‡æ–™è¼‰é«”ä¸è¶³ã€‚");
            return;
        }

        // æ”¾ç½®æ¨™è¨˜ (å¦‚æœé€™æ ¼æ²’èµ°é)
        if (!gridData[y][x].visited) {
            if (currentTool === 'stone') {
                stones--;
                gridData[y][x].content = 'stone';
                log(`æ”¾ç½®äº† [æ°¸ä¹…è¼‰é«”:çŸ³é ­]ã€‚å‰©é¤˜: ${stones}`);
            } else {
                breads--;
                gridData[y][x].content = 'bread';
                log(`æ”¾ç½®äº† [æ˜“é€è¼‰é«”:éºµåŒ…]ã€‚å‰©é¤˜: ${breads}`);
            }
            gridData[y][x].visited = true;
        } else {
            // å¦‚æœèµ°å›é ­è·¯
            log("å›æº¯å·²çŸ¥çš„è·¯å¾‘...");
        }

        // æ›´æ–°ä½ç½®
        playerPos = { x, y };
        updateUI();
        updateView();

        // æª¢æŸ¥äº‹ä»¶
        checkEvents(x, y);
    }

    // æ›´æ–°ç•«é¢ (è™•ç†è¿·éœ§èˆ‡åœ–ç¤º)
    function updateView() {
        for (let y = 0; y < gridSize; y++) {
            for (let x = 0; x < gridSize; x++) {
                const cellData = gridData[y][x];
                const el = cellData.el;
                
                // æ¸…é™¤èˆŠ class
                el.className = 'cell';
                el.innerText = '';

                // è™•ç†è¿·éœ§ (åªé¡¯ç¤ºå‘¨åœ 1 æ ¼)
                const dist = Math.abs(x - playerPos.x) + Math.abs(y - playerPos.y);
                if (dist > 1 && !cellData.visited) {
                    el.classList.add('fog');
                }

                // é¡¯ç¤ºå…§å®¹
                if (x === playerPos.x && y === playerPos.y) {
                    el.classList.add('player');
                    el.innerText = 'ğŸ§’';
                } else if (x === goalPos.x && y === goalPos.y) {
                    el.classList.add('house');
                    el.innerText = 'ğŸ ';
                } else if (x === 0 && y === 0) {
                    el.classList.add('start');
                    el.innerText = 'ğŸš©';
                } else if (cellData.content === 'stone') {
                    el.classList.add('path-stone');
                    el.innerText = 'ğŸª¨';
                } else if (cellData.content === 'bread') {
                    el.classList.add('path-bread');
                    el.innerText = 'ğŸ';
                }
            }
        }
    }

    // æª¢æŸ¥å‹åˆ©/ç›®æ¨™æ¢ä»¶
    function checkEvents(x, y) {
        // åˆ°é”ç³–æœå±‹
        if (x === 4 && y === 4 && !hasReachedGoal) {
            hasReachedGoal = true;
            goalPos = { x: 0, y: 0 }; // ç›®æ¨™è®Šå›èµ·é»
            log("ğŸ‰ ç™¼ç¾ç³–æœå±‹ï¼å¿«ä¾ç…§è·¯å¾‘é€ƒå›å®¶ï¼");
            document.querySelector('.subtitle').innerText = "ä»»å‹™æ›´æ–°ï¼šä¾ç…§æ¨™è¨˜é€ƒå›èµ·é» (0,0)";
            document.querySelector('.subtitle').style.color = "#e74c3c";
        }

        // å›åˆ°èµ·é» (å‹åˆ©)
        if (x === 0 && y === 0 && hasReachedGoal) {
            endGame(true);
        }
    }

    // ä½å…ƒè…æ•—æ©Ÿåˆ¶ (æœ€æ ¸å¿ƒçš„åœ–è³‡éš±å–»)
    function bitRot() {
        let breadCells = [];
        // æ‰¾å‡ºæ‰€æœ‰æ”¾éºµåŒ…çš„æ ¼å­
        for (let y = 0; y < gridSize; y++) {
            for (let x = 0; x < gridSize; x++) {
                if (gridData[y][x].content === 'bread') {
                    breadCells.push(gridData[y][x]);
                }
            }
        }

        // éš¨æ©Ÿç§»é™¤ä¸€å€‹
        if (breadCells.length > 0) {
            const randomIndex = Math.floor(Math.random() * breadCells.length);
            const target = breadCells[randomIndex];
            target.content = null; // è³‡æ–™éºå¤±
            
            // è¦–è¦ºç‰¹æ•ˆ
            target.el.innerText = 'âš ï¸';
            setTimeout(() => updateView(), 500);
            
            log("âš ï¸ è­¦å‘Šï¼šä¸€å€‹è³‡æ–™å€å¡Š(éºµåŒ…)ç™¼ç”Ÿ Bit Rot ææ¯€ï¼");
        }
    }

    // éŠæˆ²çµæŸ
    function endGame(win) {
        clearInterval(rotInterval);
        const screen = document.getElementById('end-screen');
        const title = document.getElementById('end-title');
        const desc = document.getElementById('end-desc');

        screen.style.display = 'flex';

        if (win) {
            title.innerText = "âœ… æ•¸ä½å…¸è—æˆåŠŸ";
            title.style.color = "#2ecc71";
            desc.innerText = "ä½ æˆåŠŸåˆ©ç”¨æ®˜å­˜çš„æª¢ç´¢é»ï¼ˆMetadataï¼‰æ‰¾å›äº†è·¯å¾‘ã€‚å„˜ç®¡éƒ¨åˆ†è³‡æ–™æµå¤±ï¼Œä½†é—œéµçš„æ°¸ä¹…è¼‰é«”ï¼ˆçŸ³é ­ï¼‰ç™¼æ®äº†ä½œç”¨ã€‚";
        } else {
            // é€™å€‹é€šå¸¸æ˜¯é€éæŒ‰é‡ç½®ï¼Œæˆ–æ˜¯æœªä¾†å¯ä»¥åŠ é™·é˜±
        }
    }

    // å·¥å…·å‡½å¼
    function setTool(tool) {
        currentTool = tool;
        document.getElementById('current-tool').innerText = tool === 'stone' ? 'ğŸª¨ çŸ³é ­ (æ°¸ä¹…)' : 'ğŸ éºµåŒ… (æ˜“é€)';
        document.getElementById('current-tool').style.color = tool === 'stone' ? '#95a5a6' : '#e67e22';
    }

    function updateUI() {
        document.getElementById('stone-val').innerText = stones;
        document.getElementById('bread-val').innerText = breads;
    }

    function log(msg) {
        logBox.innerHTML += `> ${msg}<br>`;
        logBox.scrollTop = logBox.scrollHeight;
    }

    // å•Ÿå‹•
    initGame();

</script>
</body>
</html>
