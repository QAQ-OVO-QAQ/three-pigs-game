<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç³–æœå±‹ï¼šè‘›éº—ç‰¹çš„é€†è¥² (å¤šé‡çµå±€ç‰ˆ)</title>
    <style>
        body {
            font-family: "Microsoft JhengHei", sans-serif;
            background-color: #1a0505;
            color: #ddd;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            user-select: none;
        }

        h1 { margin-top: 15px; color: #c0392b; text-shadow: 2px 2px 0 #000; }

        /* è­¦æˆ’æ¢ */
        .bar-container { width: 90%; max-width: 600px; background: #333; height: 20px; border-radius: 10px; margin-bottom: 10px; border: 2px solid #555; position: relative; overflow: hidden; }
        .bar-fill { height: 100%; background: linear-gradient(90deg, #f1c40f, #e74c3c); width: 0%; transition: width 0.5s; }
        .bar-text { position: absolute; top: 0; left: 10px; font-size: 0.8rem; line-height: 20px; color: white; text-shadow: 1px 1px 2px black; font-weight: bold; }

        /* æˆ¿é–“å ´æ™¯ */
        .room-container {
            width: 90%; max-width: 600px; height: 350px;
            background-color: #3e2723;
            border: 4px solid #5d4037;
            border-radius: 10px;
            position: relative;
            box-shadow: 0 0 30px rgba(0,0,0,0.8);
            background-image: radial-gradient(circle at center, #5d4037 0%, #281a16 100%);
            overflow: hidden;
        }

        /* ç‰©ä»¶æ¨£å¼ */
        .obj { position: absolute; cursor: pointer; transition: transform 0.2s; font-size: 3.5rem; filter: drop-shadow(0 5px 5px rgba(0,0,0,0.5)); }
        .obj:hover { transform: scale(1.1); filter: drop-shadow(0 0 10px #f39c12); }
        .obj-label { font-size: 0.8rem; background: rgba(0,0,0,0.8); color: white; padding: 2px 5px; border-radius: 4px; display: block; margin-top: -5px; text-align: center; opacity: 0; transition: opacity 0.3s; pointer-events: none; }
        .obj:hover .obj-label { opacity: 1; }

        /* ä½ç½® */
        #cage { top: 20px; left: 20px; font-size: 4rem; }
        #oven { bottom: 20px; right: 20px; font-size: 5rem; }
        #witch { top: 50px; right: 100px; font-size: 5rem; z-index: 5; display: none; }
        #table { bottom: 20px; left: 80px; font-size: 3.5rem; }
        #cupboard { top: 20px; right: 30px; font-size: 4rem; }
        #door { top: 130px; left: 10px; font-size: 4rem; filter: brightness(0.5); }

        /* å‹•ä½œé¸å–® (é»æ“Šç‰©ä»¶å¾Œå½ˆå‡º) */
        .action-menu {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.95); border: 2px solid #f1c40f; padding: 20px;
            border-radius: 10px; z-index: 20; display: none; text-align: center; min-width: 200px;
        }
        .action-btn {
            display: block; width: 100%; margin: 10px 0; padding: 10px;
            background: #34495e; color: white; border: none; cursor: pointer; border-radius: 5px; font-size: 1rem;
        }
        .action-btn:hover { background: #2980b9; }
        .btn-danger { background: #c0392b; }
        .btn-danger:hover { background: #a93226; }

        /* é“å…·æ¬„ */
        .inventory-box { width: 90%; max-width: 600px; background: #222; border: 2px solid #555; padding: 10px; margin-top: 10px; display: flex; gap: 10px; min-height: 50px; align-items: center; }
        .item { background: #444; border: 1px solid #777; padding: 5px 10px; border-radius: 5px; font-size: 0.9rem; }
        
        /* å°è©±æ¡† */
        .dialogue-box { width: 90%; max-width: 600px; height: 100px; background: rgba(0,0,0,0.6); border: 2px solid #888; border-radius: 10px; padding: 15px; margin-top: 10px; font-size: 0.95rem; line-height: 1.4; overflow-y: auto; }
        .speaker { color: #f1c40f; font-weight: bold; display: block; margin-bottom: 5px; }

        /* çµå±€é®ç½© */
        .overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.98); z-index: 100; display: none; flex-direction: column; justify-content: center; align-items: center; text-align: center; color: white; padding: 20px; }
    </style>
</head>
<body>

    <h1>ğŸ¬ è‘›éº—ç‰¹çš„é€†è¥² (v2.0)</h1>

    <div class="bar-container">
        <div class="bar-text">å¥³å·«è­¦æˆ’å€¼ (Suspicion)</div>
        <div class="bar-fill" id="suspicion-bar"></div>
    </div>

    <div class="room-container">
        <div class="obj" id="cage" onclick="openMenu('cage')">â›“ï¸<span class="obj-label">å“¥å“¥çš„ç± å­</span></div>
        <div class="obj" id="witch" onclick="openMenu('witch')">ğŸ§™â€â™€ï¸<span class="obj-label">ççœ¼å¥³å·«</span></div>
        <div class="obj" id="oven" onclick="openMenu('oven')">ğŸ”¥<span class="obj-label">å¤§çƒ¤ç®±</span></div>
        <div class="obj" id="table" onclick="openMenu('table')">ğŸ½ï¸<span class="obj-label">é¤æ¡Œ</span></div>
        <div class="obj" id="cupboard" onclick="openMenu('cupboard')">ğŸ—„ï¸<span class="obj-label">é›œç‰©æ«ƒ</span></div>
        <div class="obj" id="door" onclick="openMenu('door')">ğŸšª<span class="obj-label">å¤§é–€</span></div>
        
        <div class="action-menu" id="menu">
            <h3 id="menu-title" style="color:#f1c40f; margin-top:0;">æ¨™é¡Œ</h3>
            <div id="menu-options"></div>
            <button class="action-btn" onclick="closeMenu()" style="background:#555; margin-top:15px;">é—œé–‰</button>
        </div>
    </div>

    <div class="inventory-box">
        <span style="color:#aaa; margin-right:10px;">æŒæœ‰:</span>
        <div id="inv-container" style="display:flex; gap:10px;"></div>
    </div>

    <div class="dialogue-box">
        <span class="speaker" id="speaker-name">ç³»çµ±</span>
        <span id="dialogue-text">å¦³æ˜¯è‘›éº—ç‰¹ã€‚å“¥å“¥è¢«é—œåœ¨ç± å­è£¡ï¼Œå¥³å·«æ­£åœ¨æº–å‚™æ™šé¤ã€‚å¦³å¿…é ˆæ‰¾åˆ°éª¨é ­é¨™éæª¢æŸ¥ï¼Œä¸¦ä¼ºæ©Ÿæ®ºæ­»å¥³å·«ã€‚å°å¿ƒåˆ¥ç™¼å‡ºå¤ªå¤§è²éŸ³ï¼</span>
    </div>

    <div id="overlay" class="overlay">
        <h2 id="end-title" style="font-size: 2.5rem; margin-bottom: 20px;"></h2>
        <p id="end-desc" style="font-size: 1.1rem; line-height: 1.6; max-width: 500px; color: #ccc; margin-bottom: 30px;"></p>
        <div style="background:#222; padding:15px; border-left:4px solid #fff; text-align:left; font-size:0.9rem; max-width:500px;">
            <strong style="color: #f1c40f;">ã€çµå±€è§£æã€‘</strong><br>
            <span id="lib-note"></span>
        </div>
        <button class="action-btn" style="width: auto; margin-top: 30px; padding: 10px 30px;" onclick="location.reload()">é‡æ–°æŒ‘æˆ°</button>
    </div>

<script>
    // --- éŠæˆ²è®Šæ•¸ ---
    let suspicion = 0;
    let inventory = [];
    let phase = 0; // 0: æ¢ç´¢, 1: æª¢æŸ¥æ‰‹æŒ‡, 2: çƒ¤ç®±å°æ±º
    let isCageUnlocked = false;

    // --- äº’å‹•é‚è¼¯ ---
    function openMenu(target) {
        if (checkGameOver()) return;

        const menu = document.getElementById('menu');
        const title = document.getElementById('menu-title');
        const options = document.getElementById('menu-options');
        
        menu.style.display = 'block';
        options.innerHTML = ''; // æ¸…ç©ºé¸é …

        // æ ¹æ“šç›®æ¨™ç”Ÿæˆé¸é …
        if (target === 'table') {
            title.innerText = "é¤æ¡Œ";
            if (!hasItem('bone')) {
                addOption("ä»”ç´°ç¿»æ‰¾ (å®‰å…¨)", () => { getItem('bone', 'ğŸ— é›éª¨é ­'); say("æˆ‘åœ¨å‰©èœè£¡æ‰¾åˆ°ä¸€æ ¹é›éª¨é ­ï¼é€™å½¢ç‹€è·Ÿæ‰‹æŒ‡å¾ˆåƒã€‚"); });
                addOption("éš¨ä¾¿äº‚ç¿» (å¿«ä½†åµ)", () => { getItem('bone', 'ğŸ— é›éª¨é ­'); addSuspicion(30); say("å¦³å¼„ç¿»äº†ç›¤å­ï¼è²éŸ³å¾ˆå¤§ï¼Œå¸Œæœ›å¥³å·«æ²’è½åˆ°..."); });
            } else {
                addOption("æª¢æŸ¥å…¶ä»–æ±è¥¿", () => say("æ¡Œä¸Šåªå‰©ä¸‹çˆ›èœè‘‰äº†ã€‚"));
            }
        } 
        else if (target === 'cupboard') {
            title.innerText = "é›œç‰©æ«ƒ";
            if (!hasItem('key')) {
                addOption("è¼•è¼•æ‰“é–‹ (æ…¢)", () => { say("æ«ƒå­é–ä½äº†...éœ€è¦é‘°åŒ™æˆ–è€…æ’¬é–‹ï¼Ÿ"); });
                addOption("æš´åŠ›æ’¬é–‹ (æ¥µåº¦å±éšª)", () => { 
                    addSuspicion(100); // ç›´æ¥ Game Over
                }, true);
                addOption("ä»”ç´°æ‘¸ç´¢é ‚ç«¯", () => { 
                    getItem('key', 'ğŸ—ï¸ é‘°åŒ™'); say("é‹æ°£çœŸå¥½ï¼å¥³å·«æŠŠé‘°åŒ™è—åœ¨æ«ƒå­é ‚ç«¯ã€‚"); 
                });
            } else {
                addOption("çœ‹çœ‹è£¡é¢", () => say("è£¡é¢æœ‰ä¸€äº›ç å¯¶ï¼Œä½†ç¾åœ¨æ‹¿æœƒç™¼å‡ºè²éŸ³ã€‚å…ˆæ•‘äººè¦ç·Šã€‚"));
            }
        }
        else if (target === 'cage') {
            title.innerText = "å“¥å“¥çš„ç± å­";
            if (!isCageUnlocked) {
                if (hasItem('key')) {
                    addOption("ç”¨é‘°åŒ™è§£é–", () => { isCageUnlocked = true; say("éŸ“è³½çˆ¾ï¼šã€å¤ªå¥½äº†ï¼ä½†æˆ‘é‚„ä¸æ•¢å‡ºä¾†ï¼Œæ€•è¢«ç™¼ç¾ã€‚ç­‰å¦³è§£æ±ºå¥³å·«ï¼ã€"); });
                } else {
                    addOption("è©¦è‘—å¾’æ‰‹æ°é–‹", () => { addSuspicion(20); say("éµç± ç´‹é¢¨ä¸å‹•ï¼Œåè€Œç™¼å‡ºäº†é‡‘å±¬æ‘©æ“¦è²ï¼"); });
                    addOption("å®‰æ…°å“¥å“¥", () => say("éŸ“è³½çˆ¾ï¼šã€è‘›éº—ç‰¹...æˆ‘å¥½é¤“...åˆ¥ç®¡æˆ‘äº†ï¼Œå¦³å¿«é€ƒå§...ã€"));
                }
            } else {
                addOption("å«å“¥å“¥å‡ºä¾†", () => say("éŸ“è³½çˆ¾ï¼šã€ä¸è¡Œï¼Œå¥³å·«é‚„åœ¨é‚£è£¡ï¼ã€"));
            }
        }
        else if (target === 'door') {
            title.innerText = "å¤§é–€";
            addOption("ç¾åœ¨å°±é€ƒè·‘ (æ‹‹æ£„å“¥å“¥)", () => triggerEnding('bad_run'));
        }
        else if (target === 'witch') {
            title.innerText = "ççœ¼å¥³å·«";
            if (phase === 0) {
                addOption("é è¿‘å¥¹", () => say("å¥¹æ­£åœ¨ç£¨åˆ€ï¼Œç¾åœ¨é è¿‘å¤ªå±éšªäº†ï¼"));
                addOption("å·å¥¹çš„é­”æ–", () => { addSuspicion(50); say("å¦³å·®é»è¢«å¥¹æŠ“åˆ°ï¼å¤ªå†’éšªäº†ï¼"); }, true);
            } else if (phase === 1) {
                // æª¢æŸ¥æ‰‹æŒ‡éšæ®µ
                if (hasItem('bone')) {
                    addOption("éå‡ºé›éª¨é ­ (æ¬ºé¨™)", () => { 
                        removeItem('bone');
                        phase = 2; 
                        say("å¥³å·«ï¼šã€æ€éº¼é‚„æ˜¯æ¯æ¨¹æä¸€æ¨£ï¼Ÿå¤ªç˜¦äº†ï¼ç®—äº†ï¼Œå…ˆæŠŠçƒ¤ç®±é ç†±ï¼ã€");
                        document.getElementById('oven').style.filter = "drop-shadow(0 0 15px red)";
                        closeMenu();
                    });
                }
                addOption("ä¼¸å‡ºçœŸæ­£çš„æ‰‹æŒ‡ (èª å¯¦?)", () => triggerEnding('bad_eaten'));
            }
        }
        else if (target === 'oven') {
            title.innerText = "å¤§çƒ¤ç®±";
            if (phase < 2) {
                addOption("æª¢æŸ¥æº«åº¦", () => say("ç«é‚„æ²’ç”Ÿèµ·ä¾†ã€‚"));
            } else {
                // æ±ºæˆ°éšæ®µ
                addOption("æŠŠå¥³å·«æ¨é€²å»ï¼(æ±ºæˆ°)", () => triggerEnding('good_win'), true);
                addOption("è‡ªå·±çˆ¬é€²å»æª¢æŸ¥ (é †å¾)", () => triggerEnding('bad_baked'));
                addOption("çŒ¶è±«ä¸æ±º", () => { addSuspicion(20); say("å¥³å·«ï¼šã€é‚„åœ¨ç£¨è¹­ä»€éº¼ï¼å¿«é»ï¼ã€"); });
            }
        }
    }

    // --- è¼”åŠ©åŠŸèƒ½ ---
    function addOption(text, callback, isDanger = false) {
        const btn = document.createElement('button');
        btn.innerText = text;
        btn.className = isDanger ? 'action-btn btn-danger' : 'action-btn';
        btn.onclick = () => {
            callback();
            if (!checkGameOver()) { // å¦‚æœæ²’æ­»æ‰é—œé–‰
                 if(text.includes("æ¨é€²å»") || text.includes("çˆ¬é€²å»") || text.includes("é€ƒè·‘")) return; // çµå±€ä¸é—œé–‰
                 closeMenu();
            }
        };
        document.getElementById('menu-options').appendChild(btn);
    }

    function closeMenu() { document.getElementById('menu').style.display = 'none'; }
    
    function say(text) {
        const speaker = text.includes("ï¼š") ? text.split("ï¼š")[0] : "ç³»çµ±";
        const content = text.includes("ï¼š") ? text.split("ï¼š")[1] : text;
        document.getElementById('speaker-name').innerText = speaker;
        document.getElementById('dialogue-text').innerText = content;
    }

    function getItem(id, name) {
        if (hasItem(id)) return;
        inventory.push(id);
        const el = document.createElement('div');
        el.className = 'item';
        el.innerText = name;
        el.id = 'item-'+id;
        document.getElementById('inv-container').appendChild(el);
    }

    function hasItem(id) { return inventory.includes(id); }
    function removeItem(id) {
        inventory = inventory.filter(i => i !== id);
        document.getElementById('item-'+id).remove();
    }

    function addSuspicion(amount) {
        suspicion += amount;
        if (suspicion > 100) suspicion = 100;
        document.getElementById('suspicion-bar').style.width = suspicion + "%";
        
        if (suspicion >= 100) {
            closeMenu();
            triggerEnding('bad_caught');
        }
    }

    function checkGameOver() { return suspicion >= 100; }

    // --- åŠ‡æƒ…æ¨é€² ---
    // æ¨¡æ“¬ 10 ç§’å¾Œå¥³å·«è¦æª¢æŸ¥æ‰‹æŒ‡
    setTimeout(() => {
        if (phase === 0 && suspicion < 100) {
            phase = 1;
            document.getElementById('witch').style.display = 'block';
            say("å¥³å·«ï¼šã€éä¾†ï¼æŠŠæ‰‹æŒ‡ä¼¸å‡ºä¾†è®“æˆ‘æª¢æŸ¥ï¼ã€(é»æ“Šå¥³å·«é€²è¡Œäº’å‹•)");
        }
    }, 15000); // 15ç§’æ¢ç´¢æ™‚é–“

    // --- çµå±€ç³»çµ± ---
    function triggerEnding(type) {
        const overlay = document.getElementById('overlay');
        const title = document.getElementById('end-title');
        const desc = document.getElementById('end-desc');
        const note = document.getElementById('lib-note');
        
        overlay.style.display = 'flex';
        closeMenu();

        if (type === 'good_win') {
            title.innerText = "ğŸ† å®Œç¾çµå±€ï¼šæ©Ÿæ™ºè„«é€ƒ";
            title.style.color = "#f1c40f";
            let extra = isCageUnlocked ? "å¦³ç”¨é‘°åŒ™æ•‘å‡ºäº†å“¥å“¥ï¼Œ" : "ä½†å¦³å¿˜äº†æ‹¿é‘°åŒ™ï¼ŒèŠ±äº†å¥½å¤šæ™‚é–“æ‰æŠŠç± å­ç ¸é–‹ã€‚";
            desc.innerText = "å¦³ç”¨åŠ›å°‡å¥³å·«æ¨é€²äº†ç«çˆï¼" + extra + "å…©äººå¸¶è‘—ç å¯¶å¹³å®‰å›åˆ°äº†å®¶ã€‚";
            note.innerText = "æˆåŠŸé‹ç”¨äº†ã€Œå½é€ æ•¸æ“šï¼ˆé›éª¨é ­ï¼‰ã€æ¬ºé¨™ç›£æ§è€…ï¼Œä¸¦åˆ©ç”¨ã€Œç¤¾æœƒå·¥ç¨‹å­¸ã€å¼•èª˜æ”»æ“Šè€…æš´éœ²å¼±é»ã€‚å®Œç¾çš„è³‡è¨Šé˜²ç¦¦æˆ°ï¼";
        } 
        else if (type === 'bad_caught') {
            title.innerText = "ğŸ’€ çµå±€ Cï¼šè¢«æŠ“ä½äº†";
            title.style.color = "#e74c3c";
            desc.innerText = "å¦³ç™¼å‡ºçš„è²éŸ³å¤ªå¤§äº†ï¼å¥³å·«ä¸€æŠŠæŠ“ä½äº†å¦³ã€‚å¦³å’Œå“¥å“¥éƒ½è®Šæˆäº†æ™šé¤...";
            note.innerText = "ã€ç•°å¸¸è¡Œç‚ºåµæ¸¬ (Anomaly Detection)ã€‘ï¼šç³»çµ±åµæ¸¬åˆ°æœªç¶“æˆæ¬Šçš„é«˜é¢¨éšªæ“ä½œï¼ˆå™ªéŸ³/ç ´å£ï¼‰ï¼Œç›´æ¥è§¸ç™¼äº†é˜²ç¦¦æ©Ÿåˆ¶ï¼ˆå¥³å·«æ”»æ“Šï¼‰ã€‚åœ¨åœ–æ›¸é¤¨ä¸­ï¼Œé€™å°±åƒè©¦åœ–æš´åŠ›ç ´è§£è³‡æ–™åº«è€Œè¢«é˜²ç«ç‰†å°é–ã€‚";
        }
        else if (type === 'bad_eaten') {
            title.innerText = "ğŸ’€ çµå±€ Bï¼šå“¥å“¥è¢«åƒäº†";
            title.style.color = "#e74c3c";
            desc.innerText = "å› ç‚ºå¦³æ²’æœ‰ç”¨éª¨é ­é¨™éå¥³å·«ï¼Œå¥¹ç™¼ç¾å“¥å“¥å·²ç¶“é•·èƒ–äº†ã€‚å“¥å“¥è¢«å¸¶èµ°äº†ï¼Œè€Œå¦³åªèƒ½ç„¡åŠ©åœ°çœ‹è‘—...";
            note.innerText = "ã€é©—è­‰å¤±æ•— (Verification Failed)ã€‘ï¼šæœªèƒ½æä¾›æœ‰æ•ˆçš„å½è£æ†‘è­‰ã€‚åœ¨è³‡è¨Šå®‰å…¨ä¸­ï¼Œé€™ä»£è¡¨èº«åˆ†é©—è­‰æ²’éï¼Œå°è‡´æ©Ÿå¯†è³‡æ–™ï¼ˆå“¥å“¥ï¼‰é­ç«Šã€‚";
        }
        else if (type === 'bad_baked') {
            title.innerText = "ğŸ’€ çµå±€ Dï¼šæˆç‚ºçƒ¤è‚‰";
            title.style.color = "#e74c3c";
            desc.innerText = "å¦³å¤ªéé †å¾ï¼ŒçœŸçš„çˆ¬é€²äº†çƒ¤ç®±ã€‚å¥³å·«ç„¡æƒ…åœ°é—œä¸Šäº†é–€...";
            note.innerText = "ã€é‡£é­šæ”»æ“Šå—å®³è€… (Phishing Victim)ã€‘ï¼šä½¿ç”¨è€…ç¼ºä¹è­¦è¦ºå¿ƒï¼Œç›²ç›®è½å¾æ”»æ“Šè€…çš„æŒ‡ä»¤ï¼ˆçˆ¬é€²çƒ¤ç®±ï¼‰ï¼Œå°è‡´è‡ªèº«å¸³è™Ÿæ¬Šé™å®Œå…¨æ·ªé™·ã€‚";
        }
        else if (type === 'bad_run') {
            title.innerText = "ğŸƒ çµå±€ Eï¼šæ‡¦å¼±çš„é€ƒå…µ";
            title.style.color = "#95a5a6";
            desc.innerText = "å¦³ä¸Ÿä¸‹å“¥å“¥ä¸€å€‹äººè·‘äº†ã€‚é›–ç„¶å¦³æ´»äº†ä¸‹ä¾†ï¼Œä½†æ°¸é æ´»åœ¨æ„§ç–šä¹‹ä¸­ã€‚";
            note.innerText = "ã€è³‡æ–™éºæ£„ (Data Abandonment)ã€‘ï¼šç®¡ç†è€…æ”¾æ£„äº†æ ¸å¿ƒè³‡ç”¢ï¼ˆå“¥å“¥ï¼‰ï¼Œåªä¿ä½äº†éƒ¨åˆ†ç³»çµ±ã€‚é›–ç„¶ç”Ÿå­˜ï¼Œä½†é€ æˆäº†ä¸å¯æŒ½å›çš„è³‡æ–™æå¤±ã€‚";
        }
    }

</script>
</body>
</html>
