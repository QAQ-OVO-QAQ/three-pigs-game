<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸‰éš»å°è±¬ï¼šçŸ¥è­˜å¡ç‰Œæˆ°</title>
    <style>
        body {
            font-family: "Microsoft JhengHei", sans-serif;
            background-color: #2c3e50;
            color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            overflow: hidden;
            user-select: none;
        }

        /* éŠæˆ²èªªæ˜æ–‡å­— */
        .subtitle {
            color: #bdc3c7;
            font-size: 1rem;
            margin-top: 5px;
            margin-bottom: 20px;
            background: rgba(0,0,0,0.2);
            padding: 5px 15px;
            border-radius: 20px;
        }

        /* æˆ°å ´å€åŸŸ */
        .battlefield {
            width: 100%; max-width: 600px;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            padding: 20px;
            box-sizing: border-box;
        }

        /* å¤§é‡ç‹¼å€ (æ•µæ–¹) */
        .wolf-area { text-align: center; position: relative; }
        .wolf-avatar { font-size: 6rem; transition: transform 0.2s; display: inline-block; }
        .wolf-intent { 
            background: #c0392b; color: white; padding: 5px 15px; border-radius: 20px; 
            font-size: 0.9rem; margin-top: 10px; display: inline-block; font-weight: bold;
            box-shadow: 0 0 10px #e74c3c;
        }
        
        /* æˆ¿å­ç‹€æ…‹ (æˆ‘æ–¹ HP) */
        .house-status { 
            text-align: center; margin: 20px 0; 
            background: rgba(0,0,0,0.3); padding: 10px; border-radius: 10px;
        }
        .hp-bar-bg { width: 100%; height: 20px; background: #555; border-radius: 10px; overflow: hidden; margin-top: 5px; }
        .hp-bar-fill { height: 100%; background: #2ecc71; width: 100%; transition: width 0.3s; }

        /* å¡ç‰Œå€ (æ‰‹ç‰Œ) */
        .hand-area {
            display: flex; justify-content: center; gap: 15px; margin-bottom: 20px;
        }

        .card {
            width: 100px; height: 140px;
            background: #ecf0f1; color: #2c3e50;
            border-radius: 10px;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            border: 4px solid #bdc3c7;
            position: relative;
        }

        .card:hover { transform: translateY(-20px); box-shadow: 0 0 20px rgba(255,255,255,0.5); border-color: #f1c40f; }
        
        .card-icon { font-size: 3rem; margin-bottom: 5px; }
        .card-name { font-weight: bold; font-size: 1rem; }
        .card-type { font-size: 0.7rem; color: #7f8c8d; margin-top: 5px; }

        /* å¡ç‰Œé¡å‹é¡è‰² */
        .type-def { border-color: #3498db; } /* é˜²ç¦¦å¡ */
        .type-atk { border-color: #e67e22; } /* åæ“Šå¡ */
        .type-heal { border-color: #27ae60; } /* å›å¾©å¡ */

        /* æˆ°é¬¥è¨Šæ¯ */
        .log-display {
            height: 40px; text-align: center; color: #f1c40f; font-weight: bold; font-size: 1.2rem;
            text-shadow: 1px 1px 2px black; margin-bottom: 10px;
        }

        /* çµå±€é®ç½© */
        .overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.95); z-index: 100;
            display: none; flex-direction: column; justify-content: center; align-items: center;
            text-align: center; color: white; padding: 20px;
        }

        /* å‹•ç•« */
        .shake { animation: shake 0.5s; }
        @keyframes shake { 0%{transform:translate(0)} 20%{transform:translate(-5px,5px)} 40%{transform:translate(-5px,-5px)} 60%{transform:translate(5px,5px)} 80%{transform:translate(5px,-5px)} 100%{transform:translate(0)} }
        
        .attack-anim { animation: lunge 0.3s; }
        @keyframes lunge { 0%{transform:scale(1)} 50%{transform:scale(1.5)} 100%{transform:scale(1)} }

    </style>
</head>
<body>

    <p class="subtitle">è«‹åœ¨å¤§é‡ç‹¼çš„æ”»æ“Šåº•ä¸‹æ’éåå›åˆ</p>

    <div class="battlefield">
        <div class="wolf-area">
            <div id="wolf" class="wolf-avatar">ğŸº</div>
            <br>
            <div class="wolf-intent" id="intent-display">æ­£åœ¨è§€å¯Ÿæˆ¿å­...</div>
        </div>

        <div class="log-display" id="log">å›åˆé–‹å§‹ï¼</div>

        <div class="house-status">
            <div style="display:flex; justify-content:space-between;">
                <span>ğŸ  æˆ¿å±‹çµæ§‹ (HP)</span>
                <span id="hp-text">100/100</span>
            </div>
            <div class="hp-bar-bg">
                <div class="hp-bar-fill" id="hp-bar"></div>
            </div>
        </div>

        <div style="text-align:center; font-size:0.9rem; color:#aaa; margin-bottom:5px;">è«‹é¸æ“‡ä¸€å¼µå¡ç‰Œä¾†æ‡‰å°</div>
        <div class="hand-area" id="hand">
            </div>
    </div>

    <div id="overlay" class="overlay">
        <h2 id="end-title" style="font-size: 3rem;"></h2>
        <p id="end-desc" style="font-size: 1.2rem; margin: 20px 0;"></p>
        <div style="background:#222; padding:20px; border-left:4px solid #3498db; text-align:left; max-width:500px;">
            <strong style="color: #3498db;">ã€åœ–æ›¸è³‡è¨Šå­¸è§€é»ã€‘</strong><br>
            <span id="lib-note"></span>
        </div>
        <button onclick="location.reload()" style="margin-top:30px; padding:10px 30px; font-size:1.2rem; cursor:pointer;">å†ç©ä¸€æ¬¡</button>
    </div>

<script>
    // --- éŠæˆ²è³‡æ–™ ---
    let hp = 100;
    const maxHp = 100;
    let turn = 1;
    let wolfMove = null;

    // å¡ç‰Œè³‡æ–™åº«
    const cardDB = [
        { id: 'brick', name: 'ç£šå¡Šç‰†', type: 'def', icon: 'ğŸ§±', desc: 'æŠµæ“‹å¹æ°£' },
        { id: 'wood', name: 'æœ¨æ¿æ“‹', type: 'def', icon: 'ğŸªµ', desc: 'ç¨å¾®æŠµæ“‹' },
        { id: 'water', name: 'ç…®ç†±æ°´', type: 'atk', icon: 'ğŸ”¥', desc: 'ååˆ¶çˆ¬ç…™å›ª' },
        { id: 'trap', name: 'æ•ç¸å¤¾', type: 'atk', icon: 'âš™ï¸', desc: 'ååˆ¶æ’æ“Š' },
        { id: 'repair', name: 'åŠ å›º', type: 'heal', icon: 'ğŸ”¨', desc: 'å›å¾© +20 HP' }
    ];

    // å¤§é‡ç‹¼æ”»æ“Šæ¨¡å¼
    const wolfMoves = [
        { id: 'blow', name: 'ğŸ’¨ ç”¨åŠ›å¹æ°£', dmg: 25, counter: ['brick', 'wood'] },
        { id: 'climb', name: 'ğŸªœ çˆ¬ç…™å›ª', dmg: 40, counter: ['water'] },
        { id: 'ram', name: 'ğŸ— èº«é«”æ’æ“Š', dmg: 30, counter: ['trap', 'brick'] }
    ];

    // --- éŠæˆ²é‚è¼¯ ---
    function init() {
        nextTurn();
    }

    function nextTurn() {
        // 1. æ±ºå®šå¤§é‡ç‹¼é€™å›åˆè¦åšä»€éº¼
        wolfMove = wolfMoves[Math.floor(Math.random() * wolfMoves.length)];
        document.getElementById('intent-display').innerText = `æº–å‚™ï¼š${wolfMove.name} (å‚·å®³ ${wolfMove.dmg})`;
        document.getElementById('log').innerText = `ç¬¬ ${turn} å›åˆï¼šå¤§é‡ç‹¼æº–å‚™é€²æ”»ï¼`;

        // 2. ç™¼ç‰Œ (éš¨æ©Ÿ 3 å¼µ)
        const handEl = document.getElementById('hand');
        handEl.innerHTML = '';
        for(let i=0; i<3; i++) {
            const cardData = cardDB[Math.floor(Math.random() * cardDB.length)];
            const card = document.createElement('div');
            
            // è¨­å®šæ¨£å¼é¡åˆ¥
            let typeClass = '';
            if(cardData.type === 'def') typeClass = 'type-def';
            if(cardData.type === 'atk') typeClass = 'type-atk';
            if(cardData.type === 'heal') typeClass = 'type-heal';

            card.className = `card ${typeClass}`;
            card.innerHTML = `
                <div class="card-icon">${cardData.icon}</div>
                <div class="card-name">${cardData.name}</div>
                <div class="card-type">${cardData.desc}</div>
            `;
            card.onclick = () => playCard(cardData);
            handEl.appendChild(card);
        }
    }

    function playCard(card) {
        document.getElementById('hand').innerHTML = ''; // æ¸…ç©ºæ‰‹ç‰Œ
        
        let damage = wolfMove.dmg;
        let healAmount = 0;
        let msg = "";
        let blocked = false;

        // --- åˆ¤å®šé‚è¼¯ä¿®æ­£ (å…ˆåˆ¤å®šæ•¸å€¼ï¼Œæœ€å¾Œå†ä¸€æ¬¡è¨ˆç®—) ---
        
        // 1. å›å¾©å¡ï¼šè¨­å®šå›å¾©é‡ï¼Œä½†ä¸æ­¸é›¶å‚·å®³ (ç¡¬æ‰›å‚·å®³åŒæ™‚ä¿®è£œ)
        if (card.type === 'heal') {
            healAmount = 20;
            msg = `ä½¿ç”¨äº† ${card.name}ï¼Œæˆ¿å±‹ä¿®å¾©ä¸­...`;
        }
        // 2. å®Œç¾é˜²ç¦¦/åæ“Š (å¡ç‰Œ ID åœ¨å¤§é‡ç‹¼çš„ counter åˆ—è¡¨è£¡)
        else if (wolfMove.counter.includes(card.id)) {
            damage = 0;
            blocked = true;
            msg = `å®Œç¾é˜²ç¦¦ï¼${card.name} æˆåŠŸæ“‹ä¸‹äº† ${wolfMove.name}ï¼`;
            
            // åæ“Šç‰¹æ•ˆ
            document.getElementById('wolf').classList.add('shake');
            setTimeout(()=>document.getElementById('wolf').classList.remove('shake'), 500);
        }
        // 3. å±¬æ€§éŒ¯èª¤ (ç„¡æ•ˆç­–ç•¥)
        else {
            msg = `ç„¡æ•ˆç­–ç•¥ï¼${card.name} æ“‹ä¸ä½ ${wolfMove.name}ï¼`;
        }

        // --- æ•¸å€¼çµç®— (æ ¸å¿ƒä¿®æ­£ï¼šå…ˆæ‰£è¡€å†è£œè¡€ï¼Œç¢ºä¿ä¸æœƒå…ˆé ‚åˆ°100è¢«åƒæ‰) ---
        hp = hp - damage + healAmount;
        
        // å¦‚æœè¶…éä¸Šé™ï¼Œåˆ‡å› 100
        if (hp > maxHp) hp = maxHp;

        // æ›´æ–°ç‰¹æ•ˆèˆ‡è¨Šæ¯
        if (damage > 0) {
            document.getElementById('wolf').classList.add('attack-anim');
            setTimeout(()=>document.getElementById('wolf').classList.remove('attack-anim'), 300);
            document.body.classList.add('shake');
            setTimeout(()=>document.body.classList.remove('shake'), 500);
            
            // è£œå……è¨Šæ¯ï¼šå¦‚æœæœ‰è£œè¡€ï¼Œé¡¯ç¤ºæ·¨è®ŠåŒ–
            if (healAmount > 0) {
                let netChange = healAmount - damage;
                msg += ` (å—åˆ° ${damage} å‚·å®³ï¼Œå›å¾© ${healAmount})`; 
            } else {
                msg += ` æˆ¿å±‹å—åˆ°äº† ${damage} é»å‚·å®³ï¼`;
            }
        }

        // æ›´æ–° UI
        document.getElementById('log').innerText = msg;
        updateHpUI();

        // æª¢æŸ¥ç”Ÿæ­»
        if (hp <= 0) {
            setTimeout(() => endGame(false), 1000);
        } else if (turn >= 10) { // æ’é 10 å›åˆç²å‹
            setTimeout(() => endGame(true), 1000);
        } else {
            turn++;
            setTimeout(nextTurn, 1500);
        }
    }

    function updateHpUI() {
        if (hp < 0) hp = 0;
        document.getElementById('hp-text').innerText = `${hp}/${maxHp}`;
        document.getElementById('hp-bar').style.width = `${(hp/maxHp)*100}%`;
        
        if(hp < 30) document.getElementById('hp-bar').style.background = '#e74c3c';
        else document.getElementById('hp-bar').style.background = '#2ecc71';
    }

    function endGame(win) {
        const overlay = document.getElementById('overlay');
        const title = document.getElementById('end-title');
        const desc = document.getElementById('end-desc');
        const note = document.getElementById('lib-note');

        overlay.style.display = 'flex';

        if (win) {
            title.innerText = "ğŸ† é˜²ç¦¦æˆåŠŸ";
            title.style.color = "#f1c40f";
            desc.innerText = "ç¶“é 10 å›åˆçš„æ”»é˜²ï¼Œå¤§é‡ç‹¼ç²¾ç–²åŠ›ç›¡åœ°é›¢é–‹äº†ã€‚";
            note.innerText = "ã€ç²¾ç¢ºç‡ (Precision)ã€‘ï¼šæ‚¨å±•ç¾äº†å®Œç¾çš„è³‡è¨Šæª¢ç´¢èƒ½åŠ›ã€‚é‡å°ä½¿ç”¨è€…çš„æ¯ä¸€å€‹ã€ŒæŸ¥è©¢ï¼ˆå¤§é‡ç‹¼çš„æ”»æ“Šï¼‰ã€ï¼Œæ‚¨éƒ½èƒ½åœ¨é¤¨è—ä¸­æ‰¾åˆ°æœ€ç›¸é—œï¼ˆRelevantï¼‰çš„ã€Œè³‡æºï¼ˆå¡ç‰Œï¼‰ã€ä¾†å›æ‡‰ï¼Œæ’é™¤äº†ä¸ç›¸é—œçš„é›œè¨Šã€‚";
        } else {
            title.innerText = "ğŸšï¸ æˆ¿å±‹å€’å¡Œ";
            title.style.color = "#e74c3c";
            desc.innerText = "ä½ çš„æª¢ç´¢ç­–ç•¥å¤±æ•—ï¼Œæˆ¿å±‹çµæ§‹è¢«ç ´å£æ®†ç›¡ã€‚";
            note.innerText = "ã€æª¢ç´¢å¤±æ•— (Retrieval Failure)ã€‘ï¼šé¢å°ä½¿ç”¨è€…çš„æŸ¥è©¢éœ€æ±‚ï¼ˆæ”»æ“Šï¼‰ï¼Œç³»çµ±æœªèƒ½æä¾›æ­£ç¢ºçš„å°æ‡‰è³‡æºï¼ˆå¡ç‰Œï¼‰ã€‚å¯èƒ½æ˜¯å› ç‚ºé¤¨è—è³‡æºä¸è¶³ï¼ˆæ‰‹ç‰Œé‹æ°£å·®ï¼‰ï¼Œæˆ–æ˜¯ç´¢å¼•å°æ‡‰éŒ¯èª¤ï¼ˆæ‰“éŒ¯å¡ç‰Œï¼‰ã€‚";
        }
    }

    init();

</script>
</body>
</html>
