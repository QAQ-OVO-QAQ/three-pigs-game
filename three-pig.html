<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸‰éš»å°è±¬ï¼šçŸ¥è­˜å¡ç‰Œæˆ°</title>
    <style>
        body {
            font-family: "Microsoft JhengHei", sans-serif;
            background-color: #2c3e50;
            color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            box-sizing: border-box;
            user-select: none;
        }

        .subtitle {
            color: #bdc3c7;
            font-size: 1rem;
            margin-bottom: 20px;
            background: rgba(0,0,0,0.2);
            padding: 5px 15px;
            border-radius: 20px;
        }

        /* ä¸»å®¹å™¨ */
        .main-container {
            display: flex;
            flex-wrap: wrap;
            gap: 30px;
            justify-content: center;
            width: 100%;
            max-width: 1000px;
            align-items: flex-start;
        }

        /* å·¦å´ï¼šæˆ°è¡“æŒ‡å— */
        .guide-panel {
            background: rgba(0, 0, 0, 0.4);
            padding: 20px;
            border-radius: 15px;
            border: 2px solid #7f8c8d;
            width: 250px;
            flex-shrink: 0;
        }

        .guide-title {
            color: #f1c40f;
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 15px;
            text-align: center;
            border-bottom: 2px solid #555;
            padding-bottom: 10px;
        }

        .guide-row {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
            font-size: 0.9rem;
            background: rgba(255,255,255,0.05);
            padding: 8px;
            border-radius: 8px;
        }

        .guide-wolf { font-size: 1.5rem; margin-right: 10px; width: 40px; text-align: center; }
        .guide-arrow { color: #aaa; margin: 0 10px; font-weight: bold; }
        .guide-cards { display: flex; gap: 5px; flex-wrap: wrap; flex: 1; }
        .mini-card { 
            font-size: 0.8rem; padding: 2px 6px; 
            border-radius: 4px; border: 1px solid #aaa;
            background: #fff; color: #333; 
        }

        /* å³å´ï¼šæˆ°å ´å€åŸŸ */
        .battlefield {
            flex-grow: 1;
            max-width: 600px;
            background: rgba(255,255,255,0.05);
            border-radius: 20px;
            padding: 20px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            min-height: 550px; /*ç¨å¾®åŠ é«˜ä»¥å®¹ç´æŒ‰éˆ•*/
        }

        /* å¤§é‡ç‹¼å€ */
        .wolf-area { text-align: center; position: relative; margin-bottom: 20px; }
        .wolf-avatar { font-size: 6rem; transition: transform 0.2s; display: inline-block; }
        .wolf-intent { 
            background: #c0392b; color: white; padding: 8px 20px; border-radius: 20px; 
            font-size: 1rem; margin-top: 10px; display: inline-block; font-weight: bold;
            box-shadow: 0 0 15px #e74c3c;
            border: 2px solid #fff;
        }
        
        /* æˆ¿å­ç‹€æ…‹ */
        .house-status { 
            text-align: center; margin: 20px 0; 
            background: rgba(0,0,0,0.3); padding: 15px; border-radius: 10px;
        }
        .hp-bar-bg { width: 100%; height: 25px; background: #555; border-radius: 15px; overflow: hidden; margin-top: 5px; border: 2px solid #444; }
        .hp-bar-fill { height: 100%; background: #2ecc71; width: 100%; transition: width 0.3s; }

        /* æ“ä½œå€ (é‡æŠ½æŒ‰éˆ•èˆ‡æç¤º) */
        .action-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: auto;
            margin-bottom: 10px;
            padding: 0 10px;
        }

        .redraw-btn {
            background: #8e44ad;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-weight: bold;
            font-size: 0.9rem;
            transition: all 0.2s;
            box-shadow: 0 4px 0 #5e2d73;
        }

        .redraw-btn:hover { background: #9b59b6; transform: translateY(-2px); box-shadow: 0 6px 0 #5e2d73; }
        .redraw-btn:active { transform: translateY(2px); box-shadow: 0 0 0; }
        .redraw-btn:disabled { 
            background: #555; color: #888; cursor: not-allowed; 
            box-shadow: none; transform: none;
        }

        /* å¡ç‰Œå€ */
        .hand-area {
            display: flex; justify-content: center; gap: 15px; 
        }

        .card {
            width: 110px; height: 160px;
            background: #ecf0f1; color: #2c3e50;
            border-radius: 12px;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            border: 4px solid #bdc3c7;
            position: relative;
            text-align: center;
            padding: 5px;
        }

        .card:hover { transform: translateY(-20px); box-shadow: 0 0 25px rgba(255,255,255,0.6); border-color: #f1c40f; z-index: 10; }
        
        .card-icon { font-size: 3.5rem; margin-bottom: 5px; }
        .card-name { font-weight: bold; font-size: 1.1rem; margin-bottom: 5px;}
        .card-desc { font-size: 0.75rem; color: #555; line-height: 1.3; background: rgba(0,0,0,0.05); padding: 4px; border-radius: 4px; width: 90%; }

        /* å¡ç‰Œé¡å‹é¡è‰² */
        .type-def { border-color: #3498db; }
        .type-atk { border-color: #e67e22; }
        .type-heal { border-color: #27ae60; }

        /* æˆ°é¬¥è¨Šæ¯ */
        .log-display {
            min-height: 50px; text-align: center; color: #f1c40f; font-weight: bold; font-size: 1.3rem;
            text-shadow: 1px 1px 2px black; margin: 15px 0;
            display: flex; align-items: center; justify-content: center;
        }

        /* çµå±€é®ç½© */
        .overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.95); z-index: 100;
            display: none; flex-direction: column; justify-content: center; align-items: center;
            text-align: center; color: white; padding: 20px;
        }

        /* RWD */
        @media (max-width: 768px) {
            .main-container { flex-direction: column; align-items: center; }
            .guide-panel { width: 90%; margin-bottom: 10px; }
            .wolf-avatar { font-size: 4rem; }
            .card { width: 90px; height: 130px; }
            .card-icon { font-size: 2.5rem; }
            .action-bar { margin-bottom: 15px; }
        }

        /* å‹•ç•« */
        .shake { animation: shake 0.5s; }
        @keyframes shake { 0%{transform:translate(0)} 20%{transform:translate(-5px,5px)} 40%{transform:translate(-5px,-5px)} 60%{transform:translate(5px,5px)} 80%{transform:translate(5px,-5px)} 100%{transform:translate(0)} }
        
        .attack-anim { animation: lunge 0.3s; }
        @keyframes lunge { 0%{transform:scale(1)} 50%{transform:scale(1.5)} 100%{transform:scale(1)} }

    </style>
</head>
<body>

    <p class="subtitle">è«‹åœ¨å¤§é‡ç‹¼çš„æ”»æ“Šåº•ä¸‹æ’éåå›åˆ</p>

    <div class="main-container">
        
        <div class="guide-panel">
            <div class="guide-title">ğŸ“š æˆ°è¡“æŒ‡å— (Cheatsheet)</div>
            
            <div class="guide-row">
                <div class="guide-wolf" title="å¹æ°£">ğŸ’¨</div>
                <div class="guide-arrow">å‰‹æ˜Ÿ â”</div>
                <div class="guide-cards">
                    <span class="mini-card">ğŸ§± ç£šå¡Š</span>
                    <span class="mini-card">ğŸªµ æœ¨é ­</span>
                </div>
            </div>

            <div class="guide-row">
                <div class="guide-wolf" title="æ’æ“Š">ğŸ—</div>
                <div class="guide-arrow">å‰‹æ˜Ÿ â”</div>
                <div class="guide-cards">
                    <span class="mini-card">âš™ï¸ æ•ç¸å¤¾</span>
                    <span class="mini-card">ğŸ§± ç£šå¡Š</span>
                </div>
            </div>

            <div class="guide-row">
                <div class="guide-wolf" title="çˆ¬ç…™å›ª">ğŸªœ</div>
                <div class="guide-arrow">å‰‹æ˜Ÿ â”</div>
                <div class="guide-cards">
                    <span class="mini-card">ğŸ”¥ ç…®ç†±æ°´</span>
                </div>
            </div>

            <div style="font-size:0.8rem; color:#aaa; margin-top:10px; text-align:center;">
                ğŸ”¨ <strong>åŠ å›º</strong>ï¼šä¸è«–æ”»æ“Šé¡å‹ï¼Œçš†å¯å›å¾© HP
            </div>
        </div>

        <div class="battlefield">
            <div class="wolf-area">
                <div id="wolf" class="wolf-avatar">ğŸº</div>
                <br>
                <div class="wolf-intent" id="intent-display">æ­£åœ¨è§€å¯Ÿæˆ¿å­...</div>
            </div>

            <div class="log-display" id="log">å›åˆé–‹å§‹ï¼</div>

            <div class="house-status">
                <div style="display:flex; justify-content:space-between;">
                    <span>ğŸ  æˆ¿å±‹çµæ§‹ (HP)</span>
                    <span id="hp-text">100/100</span>
                </div>
                <div class="hp-bar-bg">
                    <div class="hp-bar-fill" id="hp-bar"></div>
                </div>
            </div>

            <div class="action-bar">
                <div style="font-size:0.9rem; color:#aaa;">è«‹é¸æ“‡ä¸€å¼µå¡ç‰Œ</div>
                <button id="redraw-btn" class="redraw-btn" onclick="redrawHand()">
                    ğŸ”„ é‡æ–°æŠ½ç‰Œ (3)
                </button>
            </div>

            <div class="hand-area" id="hand">
                </div>
        </div>
    </div>

    <div id="overlay" class="overlay">
        <h2 id="end-title" style="font-size: 3rem;"></h2>
        <p id="end-desc" style="font-size: 1.2rem; margin: 20px 0;"></p>
        <div style="background:#222; padding:20px; border-left:4px solid #3498db; text-align:left; max-width:500px;">
            <strong style="color: #3498db;">ã€åœ–æ›¸è³‡è¨Šå­¸è§€é»ã€‘</strong><br>
            <span id="lib-note"></span>
        </div>
        <button onclick="location.reload()" style="margin-top:30px; padding:10px 30px; font-size:1.2rem; cursor:pointer;">å†ç©ä¸€æ¬¡</button>
    </div>

<script>
    // --- éŠæˆ²è³‡æ–™ ---
    let hp = 100;
    const maxHp = 100;
    let turn = 1;
    let wolfMove = null;
    let redrawsLeft = 3; // å‰©é¤˜é‡æŠ½æ¬¡æ•¸

    // å¡ç‰Œè³‡æ–™åº«
    const cardDB = [
        { id: 'brick', name: 'ç£šå¡Šç‰†', type: 'def', icon: 'ğŸ§±', desc: 'é˜²ç¦¦ï¼šå¹æ°£ã€æ’æ“Š' },
        { id: 'wood', name: 'æœ¨æ¿æ“‹', type: 'def', icon: 'ğŸªµ', desc: 'é˜²ç¦¦ï¼šå¹æ°£' },
        { id: 'water', name: 'ç…®ç†±æ°´', type: 'atk', icon: 'ğŸ”¥', desc: 'ååˆ¶ï¼šçˆ¬ç…™å›ª' },
        { id: 'trap', name: 'æ•ç¸å¤¾', type: 'atk', icon: 'âš™ï¸', desc: 'ååˆ¶ï¼šæ’æ“Š' },
        { id: 'repair', name: 'åŠ å›º', type: 'heal', icon: 'ğŸ”¨', desc: 'ç·Šæ€¥ä¿®å¾© +20 HP' }
    ];

    // å¤§é‡ç‹¼æ”»æ“Šæ¨¡å¼
    const wolfMoves = [
        { id: 'blow', name: 'ğŸ’¨ ç”¨åŠ›å¹æ°£', dmg: 25, counter: ['brick', 'wood'] },
        { id: 'climb', name: 'ğŸªœ çˆ¬ç…™å›ª', dmg: 40, counter: ['water'] },
        { id: 'ram', name: 'ğŸ— èº«é«”æ’æ“Š', dmg: 30, counter: ['trap', 'brick'] }
    ];

    // --- éŠæˆ²é‚è¼¯ ---
    function init() {
        nextTurn();
    }

    function nextTurn() {
        // 1. æ±ºå®šå¤§é‡ç‹¼é€™å›åˆè¦åšä»€éº¼
        wolfMove = wolfMoves[Math.floor(Math.random() * wolfMoves.length)];
        document.getElementById('intent-display').innerText = `æº–å‚™ï¼š${wolfMove.name} (å‚·å®³ ${wolfMove.dmg})`;
        document.getElementById('log').innerText = `ç¬¬ ${turn} å›åˆï¼šå¤§é‡ç‹¼æº–å‚™é€²æ”»ï¼`;

        // 2. æ›´æ–°é‡æŠ½æŒ‰éˆ•ç‹€æ…‹
        updateRedrawBtn();

        // 3. ç™¼ç‰Œ
        drawCards();
    }

    // ç¨ç«‹å‡ºä¾†çš„ç™¼ç‰Œå‡½å¼ï¼Œä¾›ä¸‹ä¸€å›åˆå’Œé‡æŠ½ä½¿ç”¨
    function drawCards() {
        const handEl = document.getElementById('hand');
        handEl.innerHTML = '';
        for(let i=0; i<3; i++) {
            const cardData = cardDB[Math.floor(Math.random() * cardDB.length)];
            const card = document.createElement('div');
            
            let typeClass = '';
            if(cardData.type === 'def') typeClass = 'type-def';
            if(cardData.type === 'atk') typeClass = 'type-atk';
            if(cardData.type === 'heal') typeClass = 'type-heal';

            card.className = `card ${typeClass}`;
            card.innerHTML = `
                <div class="card-icon">${cardData.icon}</div>
                <div class="card-name">${cardData.name}</div>
                <div class="card-desc">${cardData.desc}</div>
            `;
            card.onclick = () => playCard(cardData);
            handEl.appendChild(card);
        }
    }

    // é‡æ–°æŠ½ç‰ŒåŠŸèƒ½
    function redrawHand() {
        if (redrawsLeft <= 0) return;
        
        redrawsLeft--;
        drawCards(); // æ›æ–°ç‰Œï¼Œä½†å¤§é‡ç‹¼æ„åœ–(wolfMove)ä¸è®Š
        updateRedrawBtn();
        
        // æ’­æ”¾ä¸€é»éŸ³æ•ˆæˆ–æ–‡å­—æç¤º
        document.getElementById('log').innerText = "ğŸ”„ å·²é‡æ–°èª¿åº¦æ‰‹ç‰Œï¼";
    }

    function updateRedrawBtn() {
        const btn = document.getElementById('redraw-btn');
        btn.innerText = `ğŸ”„ é‡æ–°æŠ½ç‰Œ (${redrawsLeft})`;
        btn.disabled = false; // é è¨­é–‹å•Ÿ

        if (redrawsLeft <= 0) {
            btn.disabled = true;
            btn.style.opacity = 0.5;
        }
    }

    function playCard(card) {
        document.getElementById('hand').innerHTML = ''; // æ¸…ç©ºæ‰‹ç‰Œ
        document.getElementById('redraw-btn').disabled = true; // æ’­æ”¾å‹•ç•«æ™‚é–ä½æŒ‰éˆ•
        
        let damage = wolfMove.dmg;
        let healAmount = 0;
        let msg = "";

        // --- åˆ¤å®šé‚è¼¯ ---
        if (card.type === 'heal') {
            healAmount = 20;
            msg = `ä½¿ç”¨äº† ${card.name}ï¼Œæˆ¿å±‹ä¿®å¾©ä¸­...`;
        }
        else if (wolfMove.counter.includes(card.id)) {
            damage = 0;
            msg = `é˜²ç¦¦æˆåŠŸï¼${card.name} æ“‹ä¸‹äº† ${wolfMove.name}ï¼`;
            
            document.getElementById('wolf').classList.add('shake');
            setTimeout(()=>document.getElementById('wolf').classList.remove('shake'), 500);
        }
        else {
            msg = `ç„¡æ•ˆï¼${card.name} æ“‹ä¸ä½ ${wolfMove.name}ï¼`;
        }

        // --- æ•¸å€¼çµç®— ---
        let newHp = hp - damage + healAmount;
        if (newHp > maxHp) newHp = maxHp;
        hp = newHp;

        if (damage > 0) {
            document.getElementById('wolf').classList.add('attack-anim');
            setTimeout(()=>document.getElementById('wolf').classList.remove('attack-anim'), 300);
            document.body.classList.add('shake');
            setTimeout(()=>document.body.classList.remove('shake'), 500);
            
            if (healAmount > 0) {
                msg += ` (å‚·å®³ -${damage}, å›å¾© +${healAmount})`; 
            } else {
                msg += ` æˆ¿å±‹ææ¯€ -${damage} HPï¼`;
            }
        } else if (damage === 0 && healAmount === 0) {
             msg += ` (å‚·å®³ 0)`;
        } else if (healAmount > 0) {
            msg += ` (å›å¾© +${healAmount})`;
        }

        document.getElementById('log').innerText = msg;
        updateHpUI();

        // æª¢æŸ¥ç”Ÿæ­»
        if (hp <= 0) {
            setTimeout(() => endGame(false), 1000);
        } else if (turn >= 10) { 
            setTimeout(() => endGame(true), 1000);
        } else {
            turn++;
            setTimeout(nextTurn, 1500);
        }
    }

    function updateHpUI() {
        if (hp < 0) hp = 0;
        document.getElementById('hp-text').innerText = `${hp}/${maxHp}`;
        document.getElementById('hp-bar').style.width = `${(hp/maxHp)*100}%`;
        
        if(hp < 30) document.getElementById('hp-bar').style.background = '#e74c3c';
        else document.getElementById('hp-bar').style.background = '#2ecc71';
    }

    function endGame(win) {
        const overlay = document.getElementById('overlay');
        const title = document.getElementById('end-title');
        const desc = document.getElementById('end-desc');
        const note = document.getElementById('lib-note');

        overlay.style.display = 'flex';

        if (win) {
            title.innerText = "ğŸ† é˜²ç¦¦æˆåŠŸ";
            title.style.color = "#f1c40f";
            desc.innerText = "ç¶“é 10 å›åˆçš„æ”»é˜²ï¼Œå¤§é‡ç‹¼ç²¾ç–²åŠ›ç›¡åœ°é›¢é–‹äº†ã€‚";
            note.innerText = "ã€ç²¾ç¢ºç‡ (Precision)ã€‘ï¼šæ‚¨å±•ç¾äº†å®Œç¾çš„è³‡è¨Šæª¢ç´¢èƒ½åŠ›ã€‚é‡å°æ¯ä¸€å€‹ã€ŒæŸ¥è©¢ï¼ˆæ”»æ“Šï¼‰ã€ï¼Œæ‚¨éƒ½èƒ½æª¢ç´¢åˆ°æœ€ç›¸é—œï¼ˆRelevantï¼‰çš„ã€Œè³‡æºï¼ˆå¡ç‰Œï¼‰ã€ï¼ŒæˆåŠŸæ»¿è¶³äº†ç³»çµ±éœ€æ±‚ã€‚";
        } else {
            title.innerText = "ğŸšï¸ æˆ¿å±‹å€’å¡Œ";
            title.style.color = "#e74c3c";
            desc.innerText = "ä½ çš„æª¢ç´¢ç­–ç•¥å¤±æ•—ï¼Œæˆ¿å±‹çµæ§‹è¢«ç ´å£æ®†ç›¡ã€‚";
            note.innerText = "ã€æª¢ç´¢å¤±æ•— (Retrieval Failure)ã€‘ï¼šé¢å°ä½¿ç”¨è€…çš„æŸ¥è©¢éœ€æ±‚ï¼ˆæ”»æ“Šï¼‰ï¼Œç³»çµ±æœªèƒ½æä¾›æ­£ç¢ºçš„å°æ‡‰è³‡æºï¼ˆå¡ç‰Œï¼‰ã€‚å¯èƒ½æ˜¯å› ç‚ºé¤¨è—è³‡æºä¸è¶³ï¼ˆæ‰‹ç‰Œé‹æ°£å·®ï¼‰ï¼Œæˆ–æ˜¯ç´¢å¼•å°æ‡‰éŒ¯èª¤ï¼ˆèª¤ç”¨å¡ç‰Œï¼‰ã€‚";
        }
    }

    init();

</script>
</body>
</html>
